<!doctype html>
<html>

<head>
     <title>Bảng điểm E17CQCN01-B - Kỹ thuật số </title>
     <script src="xlsx.full.min.js"></script>
</head>
<style>
     table,
     td,
     th {
          border: 1px solid black;
          padding: 10px;
     }

     table {
          border-collapse: collapse;
          width: 100%;
     }

     th {
          height: 50px;
     }
</style>

<body>
     <h1>Bảng điểm E17CQCN01-B - Ky thuat so</h1>
     <table>
          <thead>
               <th>Số thứ tự</th>
               <th>Mã sinh viên</th>
               <th>Họ và tên</th>
               <th>Lớp</th>
               <th>Điểm chuyên cần</th>
               <th>Điểm kiểm tra</th>
               <th>Điểm thực hành</th>
               <th>Điểm thi</th>
               <th>Điểm tổng kết</th>
               <th>Xếp loại</th>
          </thead>
          <tbody id="datalist">

          </tbody>
     </table>
     <script>
          function loadAllData(url, classname) {
               var oReq = new XMLHttpRequest();
               oReq.open("GET", url, true);
               oReq.responseType = "arraybuffer";

               oReq.onload = function (e) {
                    var arraybuffer = oReq.response;

                    var data = new Uint8Array(arraybuffer);
                    var arr = new Array();
                    for (var i = 0; i != data.length; ++i) arr[i] = String.fromCharCode(data[i]);
                    var bstr = arr.join("");


                    var workbook = XLSX.read(bstr, {
                         type: "binary"
                    });

                    var first_sheet_name = workbook.SheetNames[0];

                    var worksheet = workbook.Sheets[first_sheet_name];
                    var data = XLSX.utils.sheet_to_json(worksheet, {
                         raw: true
                    });

                    var output = data.filter(item => {
                         return item.__EMPTY_5 === classname;
                    });
                    console.log(output);
                    // loadUI(output);
               }
               oReq.send();
          }

          
          function loadPureData(filename,classname){
               var oReq = new XMLHttpRequest();
               oReq.open("GET", filename, true);
               oReq.responseType = "arraybuffer";

               oReq.onload = function (e) {
                    var arraybuffer = oReq.response;

                    var data = new Uint8Array(arraybuffer);
                    var arr = new Array();
                    for (var i = 0; i != data.length; ++i) arr[i] = String.fromCharCode(data[i]);
                    var bstr = arr.join("");


                    var workbook = XLSX.read(bstr, {
                         type: "binary"
                    });

                    var first_sheet_name = workbook.SheetNames[2];

                    var worksheet = workbook.Sheets[first_sheet_name];
                    var data = XLSX.utils.sheet_to_json(worksheet, {
                         raw: true
                    });

                    var output = data.filter(item => {
                         return item.__EMPTY_5 === classname;
                    });
                    // console.log(output);
                    loadUI(output);
                    // console.log(data);
               }
               oReq.send();

          }


          function loadUI(data) {
               var list = document.getElementById("datalist");
               var template = data.map(item => {
                    return `<tr>
                    <td>${item.__EMPTY_1}</td>
                    <td>${item.__EMPTY_2}</td>
                    <td>${item.__EMPTY_3} ${item.__EMPTY_4}</td>
                    <td>${item.__EMPTY_5}</td>
                    <td>${item.__EMPTY_6}</td>
                    <td>${item.__EMPTY_7}</td>
                    <td>${item.__EMPTY_8}</td> 
                    <td>${item.__EMPTY_13 === "c" ? "Không đủ điều kiện thi" : item.__EMPTY_13 }</td>
                    <td>${item.__EMPTY_14}</td>
                    <td>${item.__EMPTY_15}</td>
                    </tr>`;
               })
               list.innerHTML = template.join("");
          }

          // loadAllData("./datasets/KXDPT.xlsx", "D17CQPT01-B");
          // loadAllData("./dataset/KTS.xlsx","E17CQCN01-B");
          // loadAllData("./datasets/CPP.xlsx","D17CQPT01-B");

          loadPureData("./dataset/KTS.xlsx","E17CQCN01-B");
          // loadID("OOP.xlsx","B17DCCN288");
     </script>
</body>

</html>